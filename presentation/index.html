
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="/">
    <link rel="stylesheet" type="text/css" href="node_modules/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="node_modules/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="node_modules/reveal.js/css/theme/moon.css" id="theme">
    <link rel="stylesheet" href="node_modules/reveal.js/lib/css/zenburn.css">
    
    <link rel="stylesheet" type="text/css" href="main.css">
    <title>PgConfEU 2017</title>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h2>Lessons Learnt Writing PostgreSQL Extensions for JSON(b)</h2>    
            <br>
            <p>Gabriel FÃ¼rstenheim</p>
            <p><i class="fa fa-twitter icon&#45;&#45;white"> </i>&nbsp<i class="fa fa-github icon&#45;&#45;white"></i> furstenheim</p>
        </section>
        
        <section>
            <h2>JSON in Postgres</h2>
            <ul>
                <li> Two types JSON and JSONb</li>
                <li> Easy to access information</li>
                <li> Hard to manipulate</li>
                <li> Easy to add functionality through C code</li>    
            </ul>
            
        </section>
        <section>
            <h3>Selection of property</h3>
            <pre>
                <code data-trim data-noescape>
                {"a": 1, "b": 2}
                > 2
                </code></pre>
            <pre>
                <code data-trim data-noescape>
                {"a": 1, "b": 2}->'b'

                </code></pre>
        </section>
        <section>
            <h3>Property containment</h3>
            <pre>
                <code data-trim data-noescape>
                {"a": 1, "b": 2}
                > t
                </code></pre>
            <pre>
                <code data-trim data-noescape>
                {"a": 1, "b": 2} ? 'b'

                </code></pre>


        </section>

        <section>
            <h3>Sum of jsons</h3>
            <pre>
                <code data-trim data-noescape>
                {"a": 1, "b": 2}
                {"a": 3, "b": 4}
                > {"a": 4, "b": 6}
                </code></pre>
            <pre>
                <code data-trim data-noescape>
                SELECT jsonb_object_agg(key, val)
                FROM (
                    SELECT key, SUM(value::numeric) val
                    FROM test_table t, jsonb_each_text(info)
                    GROUP BY key
                 )s;   

                </code></pre>
        </section>

        <section>
            <h3>Nested sum of jsons</h3>
            <pre>
                <code data-trim data-noescape>
                {"a": {"c": 4}, "b": {"d": 4}}
                {"a": {"c": 3}, "b": {"d": 2}}
                > {"a": {"c": 7}, "b": {"d": 6}}
                </code></pre>
            <p>???</p>
        </section>
        <section>
            <h2>
                JSON Schema
            </h2>
            <pre>
                <code data-trim data-noescape>
                {
                    "type": "object",
                    "additionalProperties": false, 
                    "properties": {
                        "email": {
                            "type": "string"
                        },
                        "number_of_stores": {
                            "type": "integer"
                        }
                    }
                }
                </code></pre>
        </section>
        
        <section>
            <h2>Starting a PostgreSQL extension</h2>
            <p><a href="http://big-elephants.com/2015-10/writing-postgres-extensions-part-i/">Nice intro to writing PostgreSQL Extensions</a></p>
            <p><a>Barebone example</a></p>
        </section>

        <section>
            <div id="diagramContainer" class="jsonb-diagram">

                <div class="jsonb-diagram__column">
                    <div id="jsonb-diagram__jsonb" class="jsonb-diagram__item">
                        <span>Jsonb</span>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div id="jsonb-diagram__push-jsonb-value" class="jsonb-diagram__label">
                        <span>pushJsonbValue</span>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div id="jsonb-diagram__jsonb-iterator-token" class="jsonb-diagram__item">
                        <span>JsonbIteratorToken</span>
                    </div>
                </div>
                <div class="jsonb-diagram__column">
                    <div id="jsonb-diagram__jsonb-iterator" class="jsonb-diagram__item">
                        <span>JsonbIterator</span>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div id="jsonb-diagram__jsonb-iterator-next" class="jsonb-diagram__label">
                        <span>JsonbIteratorNext</span>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div id="jsonb-diagram__jsonb-value" class="jsonb-diagram__item">
                        <span>JsonbValue</span>
                    </div>
                    
                </div>
            </div>
        </section>
        <section>
            <h2>JsonbIterator</h2>
            <p class="fragment" data-fragment-index="1">
                Flat iteration
            </p>
            <p class="fragment" data-fragment-index="2">
                Recursive Iteration
            </p>
            <div class="jsonb_iteration__example fragment current-visible" data-fragment-index="1">
                <div class="jsonb_iteration__example__item">
                    <p>Input</p>
                    <pre>
                        <code data-trim data-noespace>
                            {
                                "a": 1,
                                "b": {
                                    "c": 2
                                }
                            }
                        </code>
                    </pre>    
                </div>
                
                <div  class="jsonb_iteration__example__item">
                    <p>Output</p>
                    <pre>
                        <code data-trim data-noespace>
                            {
                                "a"
                                "1"
                                "b"
                                {"c": 2}
                            }
                        </code>
                    </pre>
                </div>
            </div>
            <div class="jsonb_iteration__example fragment current-visible" data-fragment-index="2">
                <div class="jsonb_iteration__example__item">
                    <p>Input</p>
                    <pre>
                        <code data-trim data-noespace>
                            {
                                "a": 1,
                                "b": {
                                    "c": 2
                                }
                            }
                        </code>
                    </pre>
                </div>

                <div  class="jsonb_iteration__example__item">
                    <p>Output</p>
                    <pre>
                        <code data-trim data-noespace>
                            {
                                "a"
                                "1"
                                "b"
                                    {
                                        "c"
                                        2
                                    }
                            }
                        </code>
                    </pre>
                </div>
            </div>
        </section>
        
        <section>
            <h2>Jsonb and JsonbValue</h2>
            <ul>
                <li>Everything is a JsonbValue: keys, values, object descriptions</li>
                <li>findJsonbValueFromContainer</li>
                <li>JsonbValueToJsonb</li>
            </ul>
        </section> 
        <section>
            <h2>Building a JSONb</h2>
            <ul>
                <li>Same order as JsonbIterator</li>
                <li>pushJsonbValue</li>
            </ul>
        </section>
        
        <section>
            <h2>Geoblink</h2> 
            <p>Analytics on Maps</p>
            <img src="resources/geoblink_screenshot.jpg">
        </section>
        
        <section>
            <h2 >
                 How we use JSON?
            </h2>
            <ul>
                <li class="fragment" data-fragment-index="1">Heterogeneous fields for locations</li>
                <br>
                <li class="fragment" data-fragment-index="2">Saved user state</li>
            </ul>
            <p class="fragment current-visible" data-fragment-index="1">
                Common attributes (address, geometry...) stored as SQL.
            </p>
            <p class="fragment current-visible" data-fragment-index="1">
                Unrelated attributes (e.g. oil price for gas stations) inside a JSON field.
            </p>
        </section>
        

    </div>
</div>
<script src="bundle.js"></script>
</body>
</html>